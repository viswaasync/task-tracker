<!DOCTYPE html>
<html>
<head>
  <title>Research Group Task Tracker</title>
  <link rel="stylesheet" href="main.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="menu-bar">
    <div>
      <a href="#">Home</a>
      <div class="dropdown">
        <a href="#" class="dropbtn">View</a>
        <div class="dropdown-content">
          <a href="#lab-tab" onclick="openTab(event, 'lab-tab')">Lab Table</a>
          <a href="#analysis-tab" onclick="openTab(event, 'analysis-tab')">Data Analysis Table</a>
          <a href="#curation-tab" onclick="openTab(event, 'curation-tab')">Data Curation Table</a>
        </div>
      </div>
      <a href="#" onclick="location.reload()">Update</a>
      <h1>Research Group Task Tracker</h1>
    </div>
  </div>

  

  <div class="landing-section">
    <h2>Task Assignment Form</h2>
    <div class="input-form">
      <label for="week">Week Number:</label>
      <input type="text" id="week" placeholder="Week number"><br><br>
      <label for="order">Order Number:</label>
      <input type="text" id="order" placeholder="Order number"><br><br>
      <label for="project">Project:</label>
      <select id="project">
        <option value="PROBIO">PROBIO</option>
        <option value="CRCR">CRCR</option>
        <option value="IPCM">IPCM</option>
        <option value="PSFF">PSFF</option>
      </select><br><br>
      <label for="task">Task:</label>
      <select id="task">
        <option value="lab">Lab Work</option>
        <option value="analysis">Data Analysis</option>
        <option value="curation">Data Curation</option>
      </select><br><br>
      <label for="responsible">Responsible:</label>
      <select id="responsible">
        <option value="Johan">Johan</option>
        <option value="Markus">Markus</option>
        <option value="Rebecka">Rebecka</option>
        <option value="Anu">Anu</option>
        <option value="Preeti">Preeti</option>
        <option value="Venki">Venki</option>
        <option value="Sarath">Sarath</option>
        <option value="Nawal">Nawal</option>
        <option value="Karthick">Karthick</option>
      </select><br><br>
      <button class="update-button" onclick="updateSchedule()">Update Schedule</button>
    </div>
  </div>

  <div class="tabs">
    <button class="tab-button active" onclick="openTab(event, 'lab-tab')" id="lab-tab-button">Lab Work</button>
    <button class="tab-button" onclick="openTab(event, 'analysis-tab')" id="analysis-tab-button">Data Analysis</button>
    <button class="tab-button" onclick="openTab(event, 'curation-tab')" id="curation-tab-button">Data Curation</button>
  </div>

  <div id="lab-tab" class="tab-content">
    <h2>Lab Work</h2>
    <table>
      <thead>
        <tr>
          <th>Week Number</th>
          <th>Date</th>
          <th>Order Number </th>
          <th>Project</th>
          <th>Task</th>
          <th>Responsible</th>
        </tr>
      </thead>
      <tbody id="lab-table">

      </tbody>
    </table>
  </div>

  <div id="analysis-tab" class="tab-content">
    <h2>Data Analysis</h2>
    <table>
      <thead>
        <tr>
          <th>Week Number</th>
          <th>Date</th>
          <th>Order Number </th>
          <th>Project</th>
          <th>Task</th>
          <th>Responsible</th>
        </tr>
      </thead>
      <tbody id="analysis-table">

      </tbody>
    </table>
  </div>

  <div id="curation-tab" class="tab-content">
    <h2>Data Curation</h2>
    <table>
      <thead>
        <tr>
          <th>Week Number</th>
          <th>Date</th>
          <th>Order Number</th>
          <th>Project</th>
          <th>Task</th>
          <th>Responsible</th>
        </tr>
      </thead>
      <tbody id="curation-table">
  
      </tbody>
    </table>
  </div>

  <script>
    function openTab(evt, tabName) {

    }
  
    function updateSchedule() {

      const week = document.getElementById('week').value;
      const order = document.getElementById('order').value;
      const project = document.getElementById('project').value;
      const task = document.getElementById('task').value;
      const responsible = document.getElementById('responsible').value;
  
      fetch('/api/tasks', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ week, order, project, task, responsible })
      })
      .then(response => {
        if (response.ok) {

          return response.json();
        } else {
          throw new Error('Failed to save the task');
        }
      })
      .then(task => {

        const { week, order, project, task: taskName, responsible } = task;
        const tableId = `${taskName}-table`;
        const table = document.getElementById(tableId);
        
        const row = table.insertRow();
        const weekCell = row.insertCell(0);
        const dateCell = row.insertCell(1);
        const orderCell = row.insertCell(2)
        const projectCell = row.insertCell(3);
        const taskCell = row.insertCell(4);
        const responsibleCell = row.insertCell(5);
  
        weekCell.textContent = week;
        dateCell.textContent = convertWeekToDateRange(week);
        orderCell.textContent = order_number;
        projectCell.textContent = project;
        taskCell.textContent = taskName;
        responsibleCell.textContent = responsible;
        responsibleCell.classList.add('selected');
      })
      .catch(error => {
        console.error(error);
      });
      location.reload();
    }
  
    
    function convertWeekToDateRange(weekNumber) {
  var date = new Date();
  var offset = date.getTimezoneOffset();

  date.setMonth(0);
  date.setDate(1);

  date.setDate(date.getDate() + 4 - (date.getDay() || 7));

  date.setDate(date.getDate() + 3);

  date.setTime(date.getTime() + 7 * 24 * 60 * 60 * 1000 * (weekNumber - 1));

  date.setTime(date.getTime() + (date.getTimezoneOffset() - offset) * 60 * 1000);

  const endDate = new Date(date);
  endDate.setDate(date.getDate() + 6);
  const startMonth = date.toLocaleString('default', { month: 'short' });
  const startDay = date.getDate();
  const endMonth = endDate.toLocaleString('default', { month: 'short' });
  const endDay = endDate.getDate();

  return `${startMonth} ${startDay} - ${endMonth} ${endDay}`;
}
  
   
    fetch('/api/tasks')
      .then(response => response.json())
      .then(tasks => {
        tasks.forEach(task => {
          const { week, order_number, project, task: taskName, responsible } = task;
          const tableId = `${taskName}-table`;
          const table = document.getElementById(tableId);
          
        
          const row = table.insertRow();
          const weekCell = row.insertCell(0);
          const dateCell = row.insertCell(1);
          const orderCell = row.insertCell(2)
          const projectCell = row.insertCell(3);
          const taskCell = row.insertCell(4);
          const responsibleCell = row.insertCell(5);
  
          weekCell.textContent = week;
          dateCell.textContent = convertWeekToDateRange(week);
          orderCell.textContent = order_number;
          projectCell.textContent = project;
          taskCell.textContent = taskName;
          responsibleCell.textContent = responsible;
          responsibleCell.classList.add('selected');
        });
      })
      .catch(error => {
        console.error(error);
      });
  
    function openTab(evt, tabName) {
      var i, tabContent, tabButtons;
      tabContent = document.getElementsByClassName("tab-content");
      for (i = 0; i < tabContent.length; i++) {
        tabContent[i].style.display = "none";
      }
      tabButtons = document.getElementsByClassName("tab-button");
      for (i = 0; i < tabButtons.length; i++) {
        tabButtons[i].classList.remove("active");
      }
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.classList.add("active");
    }

    
//      function paginateTable(tableId, rowsPerPage) {
//     const table = document.getElementById(tableId);
//     const rows = table.getElementsByTagName('tr');
//     const pageCount = Math.ceil((rows.length - 1) / rowsPerPage);

//     let currentPage = 1;
//     showPage(currentPage);

//     function showPage(page) {
//       const startIndex = (page - 1) * rowsPerPage + 1;
//       const endIndex = Math.min(startIndex + rowsPerPage - 1, rows.length - 1);

//       for (let i = 1; i < rows.length; i++) {
//         if (i >= startIndex && i <= endIndex) {
//           rows[i].style.display = 'table-row';
//         } else {
//           rows[i].style.display = 'none';
//         }
//       }
//     }

//     function goToPreviousPage() {
//       if (currentPage > 1) {
//         currentPage--;
//         showPage(currentPage);
//       }
//     }

//     function goToNextPage() {
//       if (currentPage < pageCount) {
//         currentPage++;
//         showPage(currentPage);
//       }
//     }

//     const paginationContainer = document.createElement('div');
//     paginationContainer.classList.add('pagination');

//     const prevButton = document.createElement('button');
//     prevButton.textContent = 'Previous';
//     prevButton.addEventListener('click', goToPreviousPage);
//     paginationContainer.appendChild(prevButton);

//     for (let i = 1; i <= pageCount; i++) {
//       const pageButton = document.createElement('button');
//       pageButton.textContent = i;
//       pageButton.addEventListener('click', () => {
//         currentPage = i;
//         showPage(currentPage);
//       });
//       paginationContainer.appendChild(pageButton);
//     }

//     const nextButton = document.createElement('button');
//     nextButton.textContent = 'Next';
//     nextButton.addEventListener('click', goToNextPage);
//     paginationContainer.appendChild(nextButton);

//     const tableContainer = table.parentNode;
//     tableContainer.insertBefore(paginationContainer, table.nextSibling);
//   }

//   function initializePagination() {
//     paginateTable('lab-table', 10);
//     paginateTable('analysis-table', 10);
//     paginateTable('curation-table', 10);
//   }

//   function openTab(evt, tabName) {
//     const tabContent = document.getElementsByClassName('tab-content');
//     for (let i = 0; i < tabContent.length; i++) {
//       tabContent[i].style.display = 'none';
//     }

//     const tabButtons = document.getElementsByClassName('tab-button');
//     for (let i = 0; i < tabButtons.length; i++) {
//       tabButtons[i].classList.remove('active');
//     }

//     document.getElementById(tabName).style.display = 'block';
//     evt.currentTarget.classList.add('active');

//     initializePagination();
//   }

//   document.addEventListener('DOMContentLoaded', initializePagination);
// </script>
  </script>
  
</body>
</html>
